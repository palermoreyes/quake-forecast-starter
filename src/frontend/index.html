<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Quake Forecast AI ‚Äì Pron√≥stico S√≠smico Per√∫</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- SEO b√°sico -->
    <meta name="description" content="Visualizaci√≥n experimental de pron√≥sticos s√≠smicos para el Per√∫ usando modelos LSTM. Proyecto acad√©mico, no oficial.">
    <meta name="author" content="Palermo Reyes">
    <meta name="keywords" content="sismos, per√∫, predicci√≥n s√≠smica, LSTM, machine learning, IGP">

    <!-- Color del navegador m√≥vil -->
    <meta name="theme-color" content="#020617">

    <!-- CSS externos -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    >
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >
    <!-- CSS propio -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- Vista mapa -->
    <div id="map-view-container" class="active">
        <div id="map" role="application" aria-label="Mapa de riesgo s√≠smico"></div>

        <!-- Widget √öltimo Sismo IGP -->
        <div class="last-quake-container" role="complementary" aria-label="√öltimo sismo registrado">
            <div class="lq-header">
                <span class="pulse-icon" aria-hidden="true"></span> √öLTIMO SISMO IGP
            </div>
            <div class="lq-body" id="lq-content">
                <span class="lq-loading">Conectando...</span>
            </div>
            <div class="lq-footer">
                <a href="https://ultimosismo.igp.gob.pe/" target="_blank" class="igp-link" rel="noopener noreferrer">
                    Ver reporte oficial ‚Üó
                </a>
            </div>
        </div>

        <!-- Indicador de carga general -->
        <div id="loading-overlay" class="loading-overlay" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando datos...</span>
            </div>
            <p class="mt-2">Cargando pron√≥sticos...</p>
        </div>

        <!-- Toast de error -->
        <div id="error-toast" class="error-toast" style="display:none;" role="alert" aria-live="assertive">
            <div class="error-icon">‚ö†Ô∏è</div>
            <div id="error-message"></div>
            <button class="error-close" onclick="closeErrorToast()" aria-label="Cerrar mensaje de error">√ó</button>
        </div>
    </div>

    <!-- Sidebar / Panel derecho -->
    <div class="sidebar-container" id="sidebar">
        
        <!-- Header -->
        <div class="sidebar-header">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="app-title">Quake Forecast AI</h1>
                <span class="badge-model" id="model-badge">Cargando...</span>
            </div>
            <div class="status-indicator">
                <span class="status-dot"></span> Sistema Operativo
            </div>
        </div>

        <!-- Metadatos de corrida -->
        <div class="run-meta-container">
            <div class="meta-row">
                <span class="meta-label">Actualizaci√≥n:</span>
                <span class="meta-value" id="generated-date">--</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Datos hasta:</span>
                <span class="meta-value" id="input-date">--</span>
            </div>
            <div class="meta-separator"></div>
            <div class="meta-row">
                <span class="meta-label">üìÖ VIGENCIA DEL PRON√ìSTICO:</span>
            </div>
            <div class="meta-row">
                <span class="meta-value highlight" id="validity-range" style="font-size: 1.1rem;">
                    Cargando...
                </span>
            </div>
        </div>

        <!-- Recuadro de recomendaci√≥n -->
        <div id="recommendation-box" class="alert-box" style="display:none;" role="alert">
            <div class="alert-icon" aria-hidden="true">‚ö†Ô∏è</div>
            <div id="recommendation-text"></div>
        </div>

        <!-- Tabs de modo (Ciudadan√≠a / Panel cient√≠fico) -->
        <div class="mode-tabs" role="tablist">
            <button class="mode-tab active" data-mode="citizen" id="tab-citizen" role="tab" aria-selected="true" aria-controls="citizen-panel">
                Visi√≥n ciudadana
            </button>
            <button class="mode-tab" data-mode="scientific" id="tab-scientific" role="tab" aria-selected="false" aria-controls="scientific-panel">
                Panel cient√≠fico
            </button>
        </div>

        <!-- PANEL CIUDADANO -->
        <div id="citizen-panel" role="tabpanel" aria-labelledby="tab-citizen">
            <div class="list-header" id="topk-header">
                <span id="zones-count">Cargando zonas...</span>
                <button id="refresh-btn" class="refresh-btn" onclick="refreshData()" aria-label="Actualizar datos" title="Actualizar datos">
                    üîÑ
                </button>
            </div>

            <!-- Barra de b√∫squeda y filtros -->
            <div class="search-filter-container">
                <input 
                    type="text" 
                    id="search-input" 
                    class="search-input" 
                    placeholder="Buscar por lugar, coordenadas..."
                    aria-label="Buscar zonas"
                >
                <select id="filter-risk" class="filter-select" aria-label="Filtrar por nivel de riesgo">
                    <option value="all">Todos los niveles</option>
                    <option value="critical">Cr√≠tico (‚â•30%)</option>
                    <option value="very-high">Muy alto (20-30%)</option>
                    <option value="high">Alto (12-20%)</option>
                    <option value="moderate">Leve (5-12%)</option>
                </select>
            </div>

            <div class="prediction-list" id="topk-list">
                <div style="text-align: center; padding: 30px; color: #8b949e;">
                    <div class="spinner-border text-primary spinner-border-sm" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-footer warning-footer">
                <div style="font-weight: bold; color: #e6edf3; margin-bottom: 4px; font-size: 0.8rem;">
                    ‚ÑπÔ∏è INFORMACI√ìN IMPORTANTE
                </div>
                <div style="color: #8b949e; line-height: 1.3;">
                    Este sistema forma parte de un proyecto de investigaci√≥n acad√©mica
                    (Tesis Universitaria ‚Äì UPN).<br>
                    <strong>Para alertas oficiales, siga al INDECI y al IGP.</strong>
                </div>
            </div>
        </div>

        <!-- PANEL CIENT√çFICO -->
        <div id="scientific-panel" class="hidden" role="tabpanel" aria-labelledby="tab-scientific">
            <div class="sci-header">
                <h2 class="sci-title">Panel cient√≠fico</h2>
                <p class="sci-subtitle">
                    Resumen t√©cnico del pron√≥stico actual
                    (modelo de investigaci√≥n, no operativo oficial).
                </p>
            </div>

            <div class="sci-grid">
                <div class="sci-item">
                    <span class="sci-label">Modelo activo:</span>
                    <span class="sci-value" id="sci-model">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Total de zonas analizadas:</span>
                    <span class="sci-value" id="sci-total">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Zonas visibles en mapa:</span>
                    <span class="sci-value" id="sci-visible">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Prob. m√°xima detectada:</span>
                    <span class="sci-value" id="sci-maxprob">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Prob. media (visibles):</span>
                    <span class="sci-value" id="sci-avgprob">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Umbral operativo (F1 √≥ptimo):</span>
                    <span class="sci-value" id="sci-threshold">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Zonas ‚â• umbral:</span>
                    <span class="sci-value" id="sci-above">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Rango latitudinal:</span>
                    <span class="sci-value" id="sci-lat-range">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Rango longitudinal:</span>
                    <span class="sci-value" id="sci-lon-range">--</span>
                </div>
            </div>

            <div class="sci-notes">
                <p>
                    ‚Ä¢ Las probabilidades mostradas son <strong>scores relativos</strong> del modelo
                    para sismos ‚â• M4.0 en una ventana de 7 d√≠as, no una probabilidad f√≠sica exacta.
                </p>
                <p>
                    ‚Ä¢ El umbral operativo proviene de la calibraci√≥n
                    del modelo en un conjunto de prueba hist√≥rico, maximizando el F1-Score.
                </p>
                <p>
                    ‚Ä¢ Este panel est√° dise√±ado para uso acad√©mico y cient√≠fico:
                    interpretar desempe√±o, distribuci√≥n espacial del riesgo y
                    comportamiento del modelo.
                </p>
            </div>
        </div>
    </div>

    <!-- Navegaci√≥n m√≥vil (mapa / panel) -->
    <div class="mobile-nav" role="navigation">
        <button class="nav-btn" onclick="switchTab('list')" id="btn-list" aria-label="Ver lista de zonas">
            <span class="nav-icon" aria-hidden="true">üìã</span> Lista
        </button>
        <button class="nav-btn active" onclick="switchTab('map')" id="btn-map" aria-label="Ver mapa">
            <span class="nav-icon" aria-hidden="true">üåé</span> Mapa
        </button>
    </div>

    <!-- JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>