<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Quake Forecast AI | Pron√≥stico S√≠smico Per√∫</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y0D090QHZ0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Y0D090QHZ0');
    </script>

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="../images/favicon.png">
    <link rel="apple-touch-icon" href="../images/favicon.png">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- SEO b√°sico -->
    <meta name="description" content="Visualizaci√≥n experimental de pron√≥sticos s√≠smicos para el Per√∫ usando modelos LSTM. Proyecto acad√©mico, no oficial.">
    <meta name="author" content="Palermo Reyes, Paulo Arce">
    <meta name="keywords" content="sismos, per√∫, predicci√≥n s√≠smica, LSTM, machine learning, IGP">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Quake Forecast AI - Pron√≥stico S√≠smico Per√∫">
    <meta property="og:description" content="Sistema experimental de IA para pron√≥stico s√≠smico en Per√∫ usando Deep Learning (LSTM). Proyecto acad√©mico UPN.">
    <meta property="og:image" content="images/favicon.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Quake Forecast AI">
    <meta name="twitter:description" content="Pron√≥stico s√≠smico experimental con IA para Per√∫">
    <meta name="twitter:image" content="images/favicon.png">

    <!-- Color del navegador m√≥vil -->
    <meta name="theme-color" content="#020617">

    <!-- CSS externos -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- CSS propio -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- Modal de Bienvenida -->
    <div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content dark-modal">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="welcomeLabel">
                        ü§ñ Quake Forecast AI <span class="badge bg-primary ms-2" style="font-size:0.6em;">BETA</span>
                    </h5>
                </div>
                <div class="modal-body">
                    <p class="lead-text">
                        Las zonas marcadas en el mapa muestran la <strong>probabilidad estimada</strong> de que ocurra un sismo de <strong>magnitud ‚â• 4.0</strong> en los pr√≥ximos <strong>7 d√≠as</strong>, calculada con <strong>IA (red LSTM)</strong> a partir de datos hist√≥ricos.
                    </p>

                    <div class="howto-box">
                        <div class="howto-title">C√≥mo usarlo:</div>
                        <ul class="howto-ul">
                            <li><strong>Colores:</strong> m√°s intenso = mayor probabilidad estimada.</li>
                            <li><strong>Toca una zona:</strong> ver√°s el % y la vigencia (7 d√≠as).</li>
                            <li><strong>Lista:</strong> busca tu zona y salta al mapa.</li>
                        </ul>
                        <div class="howto-foot">IA LSTM (probabil√≠stica): ayuda a comparar zonas; no predice el d√≠a exacto.</div>
                    </div>
                    
                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="f-icon" aria-hidden="true">üß†</span>
                            <div>
                                <strong>Inteligencia Artificial</strong>
                                <p>Aprende patrones del historial s√≠smico con una red LSTM y genera un porcentaje estimado por zona (ventana de 7 d√≠as).</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="f-icon" aria-hidden="true">üìÖ</span>
                            <div>
                                <strong>Pron√≥stico Semanal</strong>
                                <p>El sistema proyecta la probabilidad de sismos (M4.0+) para los pr√≥ximos 7 d√≠as.</p>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning d-flex align-items-start mt-3" role="alert">
                        <div style="font-size: 1.5rem; margin-right: 12px;" aria-hidden="true">‚ö†Ô∏è</div>
                        <div>
                            <strong>Aviso Importante:</strong>
                            <div style="font-size: 0.9rem; line-height: 1.4; margin-top: 4px;">
                                Este es un proyecto de <strong>investigaci√≥n acad√©mica</strong> (Tesis Universitaria - UPN). 
                                <strong>No reemplaza las alertas oficiales del IGP o INDECI.</strong> 
                                √ösalo con fines informativos y educativos.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-primary w-100 py-2 fw-bold" data-bs-dismiss="modal" id="btn-start">
                        ENTENDIDO, VER MAPA üåé
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vista mapa -->
    <div id="map-view-container" class="active">
        <div id="map" role="application" aria-label="Mapa interactivo de riesgo s√≠smico de Per√∫"></div>

        <!-- Widget √öltimo Sismo IGP -->
        <div class="last-quake-container" role="complementary" aria-label="√öltimo sismo registrado por el IGP">
            <div class="lq-header">
                <span class="pulse-icon" aria-hidden="true"></span> √öLTIMO SISMO IGP
            </div>
            <div class="lq-body" id="lq-content">
                <span class="lq-loading">Conectando con IGP...</span>
            </div>
            <div class="lq-footer">
                <a href="https://ultimosismo.igp.gob.pe/" target="_blank" class="igp-link" rel="noopener noreferrer" aria-label="Ver reporte oficial del IGP">
                    Ver reporte oficial ‚Üó
                </a>
            </div>
        </div>

        <!-- Indicador de carga general -->
        <div id="loading-overlay" class="loading-overlay" style="display:none;" aria-busy="false">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando datos...</span>
            </div>
            <p class="mt-2">Cargando pron√≥sticos...</p>
        </div>

        <!-- Toast de error -->
        <div id="error-toast" class="error-toast" style="display:none;" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="error-icon" aria-hidden="true">‚ö†Ô∏è</div>
            <div id="error-message"></div>
            <button class="error-close" onclick="closeErrorToast()" aria-label="Cerrar mensaje de error">√ó</button>
        </div>
    </div>

    <!-- Sidebar / Panel derecho -->
    <div class="sidebar-container" id="sidebar">
        
        <!-- Header -->
        <div class="sidebar-header">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="app-title">Quake Forecast AI</h1>
                <span class="badge-model" id="model-badge">Cargando...</span>
            </div>
            <div class="status-indicator">
                <span class="status-dot" aria-hidden="true"></span> 
                <span>Sistema Operativo</span>
            </div>
        </div>

        <!-- Metadatos de corrida -->
        <div class="run-meta-container">
            <div class="meta-row">
                <span class="meta-label">Actualizaci√≥n:</span>
                <span class="meta-value" id="generated-date">--</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Datos usados hasta:</span>
                <span class="meta-value" id="input-date">--</span>
            </div>
            <div class="meta-separator"></div>
            <div class="meta-row">
                <span class="meta-label">üìÖ VIGENCIA DEL PRON√ìSTICO:</span>
            </div>
            <div class="meta-row">
                <span class="meta-value highlight" id="validity-range" style="font-size: 1.1rem;">
                    Cargando...
                </span>
            </div>
        </div>

        <!-- Recuadro de recomendaci√≥n -->
        <div id="recommendation-box" class="alert-box" style="display:none;" role="alert" aria-live="polite">
            <div class="alert-icon" aria-hidden="true">‚ö†Ô∏è</div>
            <div id="recommendation-text"></div>
        </div>

        <!-- Tabs de modo (Ciudadan√≠a / Panel cient√≠fico) -->
        <div class="mode-tabs" role="tablist" aria-label="Seleccionar modo de visualizaci√≥n">
            <button class="mode-tab active" data-mode="citizen" id="tab-citizen" role="tab" aria-selected="true" aria-controls="citizen-panel">
                Visi√≥n ciudadana
            </button>
            <button class="mode-tab" data-mode="scientific" id="tab-scientific" role="tab" aria-selected="false" aria-controls="scientific-panel">
                Panel cient√≠fico
            </button>
        </div>

        <!-- PANEL CIUDADANO -->
        <div id="citizen-panel" role="tabpanel" aria-labelledby="tab-citizen">
            <div class="list-header" id="topk-header">
                <span id="zones-count" aria-live="polite">Cargando zonas...</span>
                <div class="list-actions">
                <button id="refresh-btn" class="refresh-btn" onclick="refreshData()" aria-label="Actualizar datos del pron√≥stico" title="Actualizar datos" aria-busy="false">
                    üîÑ
                </button>
                <button id="help-btn" class="help-btn" onclick="openWelcomeModal()" aria-label="Abrir gu√≠a inicial" title="¬øC√≥mo funciona?" type="button">
                    ‚ùì
                </button>
            </div>
                <span class="meta-label">Las zonas del mapa muestran la probabilidad de que ocurra un sismo de magnitud ‚â• 4.0 en los pr√≥ximos 7 d√≠as. Toca una zona para ver el detalle.</span>
                
            </div>

            <!-- Barra de b√∫squeda y filtros -->
            <div class="search-filter-container">
                <label for="search-input" class="visually-hidden">Buscar zonas por ubicaci√≥n o coordenadas</label>
                <input 
                    type="text" 
                    id="search-input" 
                    class="search-input" 
                    placeholder="Buscar por lugar, coordenadas..."
                    aria-label="Buscar zonas por ubicaci√≥n o coordenadas"
                >
                <label for="filter-risk" class="visually-hidden">Filtrar por nivel de riesgo</label>
                <select id="filter-risk" class="filter-select" aria-label="Filtrar zonas por nivel de riesgo">
                    <option value="all">Todos los niveles</option>
                    <option value="critical">Cr√≠tico (‚â•30%)</option>
                    <option value="very-high">Muy alto (20-30%)</option>
                    <option value="high">Alto (12-20%)</option>
                    <option value="moderate">Leve (5-12%)</option>
                </select>
            </div>

            <div class="prediction-list" id="topk-list" role="region" aria-label="Lista de zonas con riesgo s√≠smico">
                <div class="loading-state">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-3" style="color: var(--text-muted);">Analizando patrones s√≠smicos...</p>
                    <p style="font-size: 0.75rem; color: var(--text-muted); opacity: 0.7;">Esto puede tomar unos segundos</p>
                </div>
            </div>

            <!-- FOOTER COLAPSABLE -->
            <div class="sidebar-footer-compact">
                <button class="info-toggle-btn" 
                        id="info-toggle-btn" 
                        onclick="toggleFooterInfo()" 
                        aria-label="Mostrar informaci√≥n importante sobre el proyecto" 
                        aria-expanded="false"
                        aria-controls="info-content"
                        title="Informaci√≥n importante sobre el proyecto">
                    <span class="info-icon" aria-hidden="true">‚ÑπÔ∏è</span>
                    <span class="info-text">INFORMACI√ìN IMPORTANTE</span>
                    <span class="chevron" id="chevron-icon" aria-hidden="true">‚ñº</span>
                </button>
                <div class="info-content" id="info-content">
                    <div class="info-content-inner">
                        Este sistema forma parte de un proyecto de investigaci√≥n acad√©mica (Tesis Universitaria ‚Äì UPN).
                        <strong>Para alertas oficiales y recomendaciones de emergencia, siga √∫nicamente al INDECI y al IGP.</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANEL CIENT√çFICO -->
        <div id="scientific-panel" class="hidden" role="tabpanel" aria-labelledby="tab-scientific">
            <div class="sci-header">
                <h2 class="sci-title">Panel cient√≠fico</h2>
                <p class="sci-subtitle">
                    Resumen t√©cnico del pron√≥stico actual
                    (modelo de investigaci√≥n, no operativo oficial).
                </p>
            </div>

            <div class="sci-grid">
                <div class="sci-item">
                    <span class="sci-label">Modelo activo:</span>
                    <span class="sci-value" id="sci-model">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Total de zonas analizadas:</span>
                    <span class="sci-value" id="sci-total">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Zonas visibles en mapa:</span>
                    <span class="sci-value" id="sci-visible">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Prob. m√°xima detectada:</span>
                    <span class="sci-value" id="sci-maxprob">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Prob. media (visibles):</span>
                    <span class="sci-value" id="sci-avgprob">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Umbral operativo (F1 √≥ptimo):</span>
                    <span class="sci-value" id="sci-threshold">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Zonas ‚â• umbral:</span>
                    <span class="sci-value" id="sci-above">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Rango latitudinal:</span>
                    <span class="sci-value" id="sci-lat-range">--</span>
                </div>
                <div class="sci-item">
                    <span class="sci-label">Rango longitudinal:</span>
                    <span class="sci-value" id="sci-lon-range">--</span>
                </div>
            </div>

            
            <div class="sci-notes">
                <p>
                    ‚Ä¢ Las zonas del mapa muestran la <strong>probabilidad estimada</strong> de un sismo <strong>‚â• 4.0</strong> en los pr√≥ximos <strong>7 d√≠as</strong>. Un valor mayor indica mayor se√±al del modelo.
                </p>
                <p>
                    ‚Ä¢ IA <strong>LSTM</strong> entrenada con datos hist√≥ricos: √∫salo como informaci√≥n referencial (no reemplaza alertas oficiales).
                </p>
            </div>
            
            <!-- Footer tambi√©n en panel cient√≠fico -->
            <div class="sci-footer-info">
                <strong>‚ÑπÔ∏è Proyecto acad√©mico (Tesis Universitaria - UPN)</strong> - Para alertas oficiales consulta con INDECI / IGP
            </div>
        </div>
    </div>

    <!-- Navegaci√≥n m√≥vil (mapa / panel) -->
    <nav class="mobile-nav" aria-label="Navegaci√≥n principal m√≥vil">
        <button class="nav-btn" onclick="switchTab('list')" id="btn-list" aria-label="Ver lista de zonas" aria-current="false">
            <span class="nav-icon" aria-hidden="true">üìã</span> 
            <span>Lista</span>
        </button>
        <button class="nav-btn active" onclick="switchTab('map')" id="btn-map" aria-label="Ver mapa" aria-current="true">
            <span class="nav-icon" aria-hidden="true">üåé</span> 
            <span>Mapa</span>
        </button>
            <button class="nav-btn" onclick="openWelcomeModal()" id="btn-help" aria-label="Abrir gu√≠a" aria-current="false" type="button">
            <span class="nav-icon" aria-hidden="true">‚ùì</span> 
            <span>Gu√≠a</span>
        </button>
</nav>

    <!-- JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html>